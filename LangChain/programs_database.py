"""
AbilityPath Real Programs Database
=====================================
Auto-generated from CSV file
Created: 2025-01-08
"""

PROGRAMS = [
    {
        "name": 'Adult Day Program, Burlingame',
        "description": 'Day Program at Burlingame provides adults with developmental disabilities the experiential knowledge and skills to make informed decisions about and participate in their preferred types and levels of community engagement, including employment, volunteering, and social and recreational activities.',
        "location": 'San Mateo County',
        "age_range": {'min_age': 18, 'max_age': None},
        "diagnosis_accepted": ['Developmental Disability'],
        "support_requirements": {'toilet_trained': True, 'eating_independence': True, 'mobility_independence': True, 'medication_independence': True, 'behavioral_requirements': []},
        "counties_served": ['San Mateo County'],
        "physical_location": '899 Stanton Rd, Burlingame, CA 94010\nand at various locations in the local community',
        "schedule": '5 days per week (Monday-Friday) from 9:00 AMâ€“3:00 PM\nPart-time Monday, Wednesday, Friday and Tuesday, Thursday options available',
        "enrollment_process": 'To begin the intake process, please contact your Regional Center Service Coordinator and request they email a referral packet to intake@abilitypath.org.\n\nRequired Documents:\n\n*Facesheet\n*CDER\n*Current IPP\n*Medical Report\n*Psychological Report\n*Social Report',
        "program_type": ['Employment Support', 'Social Activities', 'Day Programs'],
    },
    {
        "name": 'Adult Day Program, Daly City',
        "description": 'Day Program at Daly City provides adults with developmental disabilities the experiential knowledge and skills to make informed decisions about and participate in their preferred types and levels of community engagement, including employment, volunteering, and social and recreational activities.',
        "location": 'San Mateo County',
        "age_range": {'min_age': 18, 'max_age': None},
        "diagnosis_accepted": ['Developmental Disability'],
        "support_requirements": {'toilet_trained': True, 'eating_independence': True, 'mobility_independence': True, 'medication_independence': True, 'behavioral_requirements': []},
        "counties_served": ['San Mateo County'],
        "physical_location": '550 Washington St #100, Daly City, CA 94015\nand at various locations in the local community',
        "schedule": '5 days per week (Monday-Friday) from 9:00 AMâ€“3:00 PM\nPart-time Monday, Wednesday, Friday and Tuesday, Thursday options available',
        "enrollment_process": 'To begin the intake process, please contact your Regional Center Service Coordinator and request they email a referral packet to intake@abilitypath.org.\n\nRequired Documents:\n\n*Facesheet\n*CDER\n*Current IPP\n*Medical Report\n*Psychological Report\n*Social Report',
        "program_type": ['Employment Support', 'Social Activities', 'Day Programs'],
    },
    {
        "name": 'Community Access Adult Day Program',
        "description": 'Community Access is a community-based day program designed is to provide adults with developmental disabilities the experiential knowledge and skills to make informed decisions about and participate in their preferred types and levels of community engagement, including employment, volunteering, and social and recreational activities.',
        "location": 'San Mateo County',
        "age_range": {'min_age': 18, 'max_age': None},
        "diagnosis_accepted": ['Developmental Disability'],
        "support_requirements": {'toilet_trained': True, 'eating_independence': True, 'mobility_independence': True, 'medication_independence': True, 'behavioral_requirements': []},
        "counties_served": ['San Mateo County'],
        "physical_location": 'Various locations in the community',
        "schedule": '5 days per week (Monday-Friday) from 9:00 AMâ€“3:00 PM\nPart-time Monday, Wednesday, Friday and Tuesday, Thursday options available',
        "enrollment_process": 'To begin the intake process, please contact your Regional Center Service Coordinator and request they email a referral packet to intake@abilitypath.org.\n\nRequired Documents:\n\n*Facesheet\n*CDER\n*Current IPP\n*Medical Report\n*Psychological Report\n*Social Report',
        "program_type": ['Employment Support', 'Social Activities', 'Day Programs'],
    },
    {
        "name": 'Adult Day Program, San Jose',
        "description": 'Day Program at San Jose is a community-based day program designed to provide adults with developmental disabilities the experiential knowledge and skills to make informed decisions about and participate in their preferred types and levels of community engagement, including employment, volunteering, and social and recreational activities.',
        "location": 'Santa Clara County',
        "age_range": {'min_age': 18, 'max_age': None},
        "diagnosis_accepted": ['Developmental Disability'],
        "support_requirements": {'toilet_trained': True, 'eating_independence': True, 'mobility_independence': True, 'medication_independence': True, 'behavioral_requirements': []},
        "counties_served": ['Santa Clara County'],
        "physical_location": 'Based out of 2248 N. First Street, San Jose, CA 95131\nProgram occurs at various locations in the local community',
        "schedule": '5 days per week (Monday-Friday) from 9:00 AMâ€“3:00 PM\nPart-time Monday, Wednesday, Friday and Tuesday, Thursday options available',
        "enrollment_process": 'To begin the intake process, please contact your Regional Center Service Coordinator and request they email a referral packet to intake@abilitypath.org.\n\nRequired Documents:\n\n*Facesheet\n*CDER\n*Current IPP',
        "program_type": ['Employment Support', 'Social Activities', 'Day Programs'],
    },
    {
        "name": 'Adult Day Program, Palo Alto',
        "description": 'Day Program at Palo Alto is a community-based day program designed to provide adults with developmental disabilities the experiential knowledge and skills to make informed decisions about and participate in their preferred types and levels of community engagement, including employment, volunteering, and social and recreational activities.',
        "location": 'Santa Clara County',
        "age_range": {'min_age': 18, 'max_age': None},
        "diagnosis_accepted": ['Developmental Disability'],
        "support_requirements": {'toilet_trained': True, 'eating_independence': True, 'mobility_independence': True, 'medication_independence': True, 'behavioral_requirements': []},
        "counties_served": ['Santa Clara County'],
        "physical_location": 'Based out of 3864 Middlefield Rd, Palo Alto, CA 94303\nProgram occurs at various locations in the local community',
        "schedule": '5 days per week (Monday-Friday) from 9:00 AMâ€“3:00 PM\nPart-time Monday, Wednesday, Friday and Tuesday, Thursday options available',
        "enrollment_process": 'To begin the intake process, please contact your Regional Center Service Coordinator and request they email a referral packet to intake@abilitypath.org.\n\nRequired Documents:\n\n*Facesheet\n*CDER\n*Current IPP',
        "program_type": ['Employment Support', 'Social Activities', 'Day Programs'],
    },
    {
        "name": 'Youth Social Recreation',
        "description": 'Social Recreation has inclusive programming for youth ages 12-17 with developmental disabilities. Social Rec focuses on building meaningful connections, freidnships, and exploring abilities and interests. Programs are offered on weekends, weeknights, summer, and during school breaks.',
        "location": 'Both San Mateo and Santa Clara',
        "age_range": {'min_age': 12, 'max_age': 17},
        "diagnosis_accepted": ['Developmental Disability'],
        "support_requirements": {'toilet_trained': True, 'eating_independence': True, 'mobility_independence': True, 'medication_independence': True, 'behavioral_requirements': []},
        "counties_served": ['Santa Clara County', 'San Mateo County'],
        "physical_location": 'Various locations in the community or at an AbilityPath site',
        "schedule": 'Days and times vary. Please visit https://abilitypath.org/services/adult-services/social-recreation-programs/ for upcoming programs',
        "enrollment_process": 'To begin the intake process, please email socialrec@abilitypath.org',
        "program_type": ['Social Activities'],
    },
    {
        "name": 'Adult Social Recreation',
        "description": 'Social Recreation has inclusive programming for adults ages 18-30 with developmental disabilities. Social Rec focuses on building meaningful connections, freidnships, and exploring abilities and interests. Programs are offered on weekends, weeknights, summer, and during school breaks.',
        "location": 'Both San Mateo and Santa Clara',
        "age_range": {'min_age': 18, 'max_age': None},
        "diagnosis_accepted": ['Developmental Disability'],
        "support_requirements": {'toilet_trained': True, 'eating_independence': True, 'mobility_independence': True, 'medication_independence': True, 'behavioral_requirements': []},
        "counties_served": ['Santa Clara County', 'San Mateo County'],
        "physical_location": 'Various locations in the community or at an AbilityPath site',
        "schedule": 'Days and times vary. Please visit https://abilitypath.org/services/adult-services/social-recreation-programs/ for upcoming programs',
        "enrollment_process": 'To begin the intake process, please email socialrec@abilitypath.org',
        "program_type": ['Social Activities'],
    },
    {
        "name": 'Independent Living Skills, North',
        "description": 'Independent Living Skills (ILS) offers 1:1 coaching at home or in the community to help participants learn everyday skills like cooking, cleaning, budgeting, travel, safety, and socializing, building confidence and living more independently.',
        "location": 'SF to Palo Alto',
        "age_range": {'min_age': 18, 'max_age': None},
        "diagnosis_accepted": ['Developmental Disability'],
        "support_requirements": {'toilet_trained': True, 'eating_independence': True, 'mobility_independence': True, 'medication_independence': True, 'behavioral_requirements': []},
        "counties_served": ['San Francisco', 'San Mateo County'],
        "physical_location": "At the individual's residence or in the community",
        "schedule": 'Scheduling is flexible and arranged mutually between the individual and the assigned staff member',
        "enrollment_process": 'To begin the intake process, please contact your Regional Center Service Coordinator and request they email a referral packet to intake@abilitypath.org.\n\nRequired Documents:\n\n*Facesheet\n*CDER\n*Current IPP\n*Medical Report\n*Psychological Report\n*Social Report',
        "program_type": ['Living Skills', 'Social Activities'],
    },
    {
        "name": 'Independent Living Skills, South',
        "description": 'Independent Living Skills (ILS) offers 1:1 coaching at home or in the community to help participants learn everyday skills like cooking, cleaning, budgeting, travel, safety, and socializing, building confidence and living more independently.',
        "location": 'Palo Alto to Santa Cruz',
        "age_range": {'min_age': 18, 'max_age': None},
        "diagnosis_accepted": ['Developmental Disability'],
        "support_requirements": {'toilet_trained': True, 'eating_independence': True, 'mobility_independence': True, 'medication_independence': True, 'behavioral_requirements': []},
        "counties_served": ['Santa Cruz County', 'Santa Clara County'],
        "physical_location": "At the individual's residence or in the community",
        "schedule": 'Scheduling is flexible and arranged mutually between the individual and the assigned staff member',
        "enrollment_process": 'To begin the intake process, please contact your Regional Center Service Coordinator and request they email a referral packet to intake@abilitypath.org.\n\nRequired Documents:\n\n*Facesheet\n*CDER\n*Current IPP',
        "program_type": ['Living Skills', 'Social Activities'],
    },
    {
        "name": 'Tailored Day Services, San Mateo County',
        "description": 'In Tailored Day Services, participants work one-on-one with an instructor to build skills for a more independent, inclusive life. Services are pre-employment focused and may include job exploration, social and recreational activities, college support, daily living skills, and personal interest pursuits.',
        "location": 'San Mateo County',
        "age_range": {'min_age': 18, 'max_age': None},
        "diagnosis_accepted": ['Developmental Disability'],
        "support_requirements": {'toilet_trained': True, 'eating_independence': True, 'mobility_independence': True, 'medication_independence': True, 'behavioral_requirements': []},
        "counties_served": ['San Mateo County'],
        "physical_location": 'Various locations in the community or at an AbilityPath site',
        "schedule": 'Scheduling is flexible and arranged mutually between the individual and the assigned staff member',
        "enrollment_process": 'To begin the intake process, please contact your Regional Center Service Coordinator and request they email a referral packet to intake@abilitypath.org.\n\nRequired Documents:\n\n*Facesheet\n*CDER\n*Current IPP\n*Medical Report\n*Psychological Report\n*Social Report',
        "program_type": ['Employment Support', 'Living Skills', 'Social Activities', 'Day Programs'],
    },
    {
        "name": 'Employment Services, San Mateo County',
        "description": 'Employment Services supports individuals with foundational workplace readiness in their employment journey through customized employment tracks (ex: paid internships, group employment, or job placement). Services are designed to maximize success and include resume/cover letter development, interview preparation and support, and dedicated job coaching.',
        "location": 'San Mateo County',
        "age_range": {'min_age': 18, 'max_age': None},
        "diagnosis_accepted": ['Developmental Disability'],
        "support_requirements": {'toilet_trained': True, 'eating_independence': True, 'mobility_independence': True, 'medication_independence': True, 'behavioral_requirements': []},
        "counties_served": ['San Mateo County'],
        "physical_location": 'Various locations in the community or at an AbilityPath site',
        "schedule": 'Scheduling is flexible and arranged mutually between the individual and the assigned staff member',
        "enrollment_process": 'To begin the intake process, please follow these steps:\n\n1. Complete the Department of Rehabilitation (DOR) Application Form.\n2.  Submit the completed form to your local DOR office (via email, mail, or in person).\n\nOnce your DOR application is processed, the DOR will send us a referral packet. We will review this information and then contact you directly to continue the intake process.',
        "program_type": ['Employment Support'],
    },
    {
        "name": 'Employment Services,Santa Clara County',
        "description": 'Employment Services supports individuals with foundational workplace readiness in their employment journey through customized employment tracks (ex: paid internships, group employment, or job placement). Services are designed to maximize success and include resume/cover letter development, interview preparation and support, and dedicated job coaching.',
        "location": 'Santa Clara County',
        "age_range": {'min_age': 18, 'max_age': None},
        "diagnosis_accepted": ['Developmental Disability', 'Traumatic Brain Injury', 'Stroke'],
        "support_requirements": {'toilet_trained': True, 'eating_independence': True, 'mobility_independence': True, 'medication_independence': True, 'behavioral_requirements': []},
        "counties_served": ['Santa Clara County'],
        "physical_location": 'Various locations in the community',
        "schedule": 'Scheduling is flexible and arranged mutually between the individual and the assigned staff member',
        "enrollment_process": 'To begin the intake process, please follow these steps:\n\n1. Complete the Department of Rehabilitation (DOR) Application Form.\n2.  Submit the completed form to your local DOR office (via email, mail, or in person).\n\nOnce your DOR application is processed, the DOR will send us a referral packet. We will review this information and then contact you directly to continue the intake process.',
        "program_type": ['Employment Support'],
    },
    {
        "name": 'Immersion Work Readiness Program',
        "description": 'The Immersion Work Readiness Program prepares individuals with a range of disabilities (including but not limited to physical, intellectual, developmental, mental health conditions, stroke, and traumatic brain injury) for meaningful, community-based employment. Through structured, small-group modules and individualized service planning, the program equips individuals with the work readiness skills and supports needed to thrive in inclusive workplace settings.',
        "location": 'Santa Clara County',
        "age_range": {'min_age': 18, 'max_age': None},
        "diagnosis_accepted": ['Traumatic Brain Injury', 'Stroke', 'Physical Disability', 'Mental Health Condition'],
        "support_requirements": {'toilet_trained': True, 'eating_independence': True, 'mobility_independence': True, 'medication_independence': True, 'behavioral_requirements': []},
        "counties_served": ['Santa Clara County'],
        "physical_location": '2248 N. First Street, San Jose, CA 95131',
        "schedule": '5 days per week (Monday-Friday) from 9:00 AMâ€“2:00 PM',
        "enrollment_process": "Since this is a new program, how they get started depends on the chatbot process. We haven't started an interest list yet. If the chatbot automatically records responses and they indicated they're interested in Immersion, we will contact them directly. If the chatbot doesn't have contact info, it should refer them to fill out the AbilityPath Interest Form. This process will change in the future once our program has been approved by the Department of Rehabilitation.",
        "program_type": ['Employment Support'],
    },
    {
        "name": 'Creative Arts Program',
        "description": 'The upcoming Creative Arts Program empowers adults witih intellectual and developmental disabilites to express themselves creatively, develop artistic and vocational skills, and build community connections through the arts within inclusive community and studio environments.',
        "location": 'Santa Clara County',
        "age_range": {'min_age': 18, 'max_age': None},
        "diagnosis_accepted": ['Developmental Disability'],
        "support_requirements": {'toilet_trained': True, 'eating_independence': True, 'mobility_independence': True, 'medication_independence': True, 'behavioral_requirements': []},
        "counties_served": ['Santa Clara County'],
        "physical_location": '525 East Charleston Road, Palo Alto, CA 94306',
        "schedule": 'Days and times TBD',
        "enrollment_process": "Since this is a new program, how they get started depends on the chatbot process. We haven't started an interest list yet. If the chatbot automatically records responses and they indicated they're interested in Immersion, we will contact them directly. If the chatbot doesn't have contact info, it should refer them to fill out the AbilityPath Interest Form. This process will change in the future once our program has been approved by San Andreas Regional Center",
        "program_type": ['Employment Support', 'Creative Arts'],
    },
    {
        "name": 'REACH (Stroke & Traumatic Brain Injury Services)',
        "description": 'REACH offers therapeutic services and programming for people with stroke and traumatic brain injuries previously provided by two organizations. Our licensed physical, speech, and occupational therapists have decades of learning and hands-on service expertise.',
        "location": 'Both San Mateo and Santa Clara',
        "age_range": {'min_age': None, 'max_age': None},
        "diagnosis_accepted": ['Traumatic Brain Injury', 'Stroke'],
        "support_requirements": {'toilet_trained': True, 'eating_independence': True, 'mobility_independence': True, 'medication_independence': True, 'behavioral_requirements': []},
        "counties_served": ['Santa Clara County', 'San Mateo County'],
        "physical_location": 'Cubberley Community Center\n4000 Middlefield Road, Building P\nPalo Alto, CA 94303',
        "schedule": 'Please contact braininjuryservices@abilitypath.org for the class schedule and 1-1 session times',
        "enrollment_process": 'To begin the intake process, please contact braininjuryservices@abilitypath.org',
        "program_type": ['Therapeutic Services'],
    },
]


def get_all_programs():
    """Return all available programs."""
    return PROGRAMS

def get_program_by_name(name: str):
    """Get a specific program by name."""
    for program in PROGRAMS:
        if program["name"].lower() == name.lower():
            return program
    return None

def get_programs_by_county(county: str):
    """Get programs serving a specific county."""
    return [p for p in PROGRAMS if county in p.get("counties_served", [])]

def get_programs_by_type(program_type: str):
    """Get programs of a specific type."""
    return [p for p in PROGRAMS if program_type in p.get("program_type", [])]


def filter_programs_by_criteria(user_profile):
    """
    Filter and score programs based on user profile criteria.
    
    Args:
        user_profile (dict): Dictionary containing:
            - age (int): User's age
            - diagnosis (str): Primary diagnosis
            - location (str): County or city
            - interests (list): List of interest areas
            - support_needs (dict): Support requirements
    
    Returns:
        list: Recommended programs with match scores
    """
    recommendations = []
    
    age = user_profile.get('age')
    diagnosis = user_profile.get('diagnosis', '').lower()
    location = user_profile.get('location', '').lower()
    interests = user_profile.get('interests', [])
    
    for program in PROGRAMS:
        # Step 1: AGE FILTER (Hard requirement)
        age_range = program.get('age_range', {})
        min_age = age_range.get('min_age')
        max_age = age_range.get('max_age')
        
        # Check if age falls within range
        if min_age is not None and age < min_age:
            continue  # Skip this program
        if max_age is not None and age > max_age:
            continue  # Skip this program
        
        # Step 2: CALCULATE MATCH SCORE
        match_score = 0
        total_criteria = 0
        criteria_details = []
        
        # 2a. DIAGNOSIS MATCH
        diagnosis_accepted = program.get('diagnosis_accepted', [])
        if diagnosis_accepted:
            total_criteria += 1
            diagnosis_match = False
            
            for accepted_dx in diagnosis_accepted:
                if accepted_dx.lower() in diagnosis or diagnosis in accepted_dx.lower():
                    diagnosis_match = True
                    break
            
            if diagnosis_match:
                match_score += 1
                criteria_details.append("âœ“ Diagnosis matches")
            else:
                criteria_details.append("âœ— Diagnosis doesn't match")
        
        # 2b. LOCATION MATCH
        counties_served = program.get('counties_served', [])
        location_field = program.get('location', '')
        
        if counties_served or location_field:
            total_criteria += 1
            location_match = False
            
            # Check against counties served
            for county in counties_served:
                if location in county.lower() or county.lower() in location:
                    location_match = True
                    break
            
            # Check against location field
            if not location_match and location_field:
                if location in location_field.lower() or location_field.lower() in location:
                    location_match = True
            
            if location_match:
                match_score += 1
                criteria_details.append("âœ“ Location matches")
            else:
                criteria_details.append("âœ— Location doesn't match")
        
        # 2c. INTEREST/PROGRAM TYPE MATCH
        program_types = program.get('program_type', [])
        if program_types and interests:
            total_criteria += 1
            interest_match = False
            
            for interest in interests:
                for prog_type in program_types:
                    if interest.lower() in prog_type.lower() or prog_type.lower() in interest.lower():
                        interest_match = True
                        break
                if interest_match:
                    break
            
            if interest_match:
                match_score += 1
                criteria_details.append("âœ“ Interest matches")
            else:
                criteria_details.append("âœ— Interest doesn't match")
        
        # 2d. SUPPORT REQUIREMENTS (if provided in user profile)
        support_needs = user_profile.get('support_needs', {})
        if support_needs:
            program_requirements = program.get('support_requirements', {})
            if program_requirements:
                total_criteria += 1
                support_match = True
                
                # Check key support factors
                if support_needs.get('toilet_trained') == False and program_requirements.get('toilet_trained') == True:
                    support_match = False
                if support_needs.get('eating_independence') == False and program_requirements.get('eating_independence') == True:
                    support_match = False
                if support_needs.get('mobility_independence') == False and program_requirements.get('mobility_independence') == True:
                    support_match = False
                
                if support_match:
                    match_score += 1
                    criteria_details.append("âœ“ Support level appropriate")
                else:
                    criteria_details.append("âœ— Support needs don't match requirements")
        
        # Step 3: CALCULATE MATCH PERCENTAGE
        if total_criteria > 0:
            match_percentage = (match_score / total_criteria) * 100
        else:
            match_percentage = 0
        
        # Step 4: APPLY THRESHOLD (60% minimum)
        if match_percentage >= 60:
            recommendations.append({
                'program': program,
                'match_percentage': match_percentage,
                'match_score': match_score,
                'total_criteria': total_criteria,
                'criteria_details': criteria_details
            })
    
    # Step 5: SORT BY MATCH PERCENTAGE (highest first)
    recommendations.sort(key=lambda x: x['match_percentage'], reverse=True)
    
    return recommendations


def format_program_recommendations(recommendations, max_programs=5):
    """
    Format program recommendations into a user-friendly string.
    
    Args:
        recommendations (list): List of recommended programs with scores
        max_programs (int): Maximum number of programs to show
    
    Returns:
        str: Formatted recommendation text
    """
    if not recommendations:
        return """I couldn't find any programs that match your criteria at this time. 
This might be because:
- Your location is outside our current service areas
- The age doesn't match our current program offerings
- We may need more information to find the right fit

I recommend contacting AbilityPath directly at intake@abilitypath.org or calling them 
to discuss specialized options that might be available."""
    
    output = []
    output.append("Based on your needs, here are my top recommendations:\n")
    
    # Show top programs (up to max_programs)
    for i, rec in enumerate(recommendations[:max_programs], 1):
        program = rec['program']
        match_pct = rec['match_percentage']
        
        output.append(f"\n{'='*70}")
        output.append(f"#{i} - {program['name']} (Match: {match_pct:.0f}%)")
        output.append(f"{'='*70}")
        
        # Description
        output.append(f"\nðŸ“‹ DESCRIPTION:")
        output.append(f"{program.get('description', 'No description available.')}\n")
        
        # Location
        output.append(f"ðŸ“ LOCATION:")
        output.append(f"{program.get('physical_location', 'Various locations')}")
        counties = program.get('counties_served', [])
        if counties:
            output.append(f"Serves: {', '.join(counties)}")
        output.append("")
        
        # Age Range
        age_range = program.get('age_range', {})
        min_age = age_range.get('min_age', 'Any')
        max_age = age_range.get('max_age', 'Any')
        if min_age != 'Any' and max_age != 'Any':
            output.append(f"ðŸ‘¤ AGE RANGE: {min_age}-{max_age} years old")
        elif min_age != 'Any':
            output.append(f"ðŸ‘¤ AGE RANGE: {min_age}+ years old")
        else:
            output.append(f"ðŸ‘¤ AGE RANGE: All ages")
        
        # Diagnosis
        diagnosis = program.get('diagnosis_accepted', [])
        if diagnosis:
            output.append(f"ðŸ¥ ACCEPTS: {', '.join(diagnosis)}")
        
        # Program Type
        program_types = program.get('program_type', [])
        if program_types:
            output.append(f"ðŸŽ¯ PROGRAM TYPE: {', '.join(program_types)}")
        
        # Schedule
        schedule = program.get('schedule', '')
        if schedule:
            output.append(f"\nâ° SCHEDULE:")
            output.append(f"{schedule}")
        
        # Enrollment Process
        enrollment = program.get('enrollment_process', '')
        if enrollment:
            output.append(f"\nðŸ“ HOW TO GET STARTED:")
            output.append(f"{enrollment}")
        
        # Match Details
        output.append(f"\nâœ¨ WHY THIS MATCHES ({match_pct:.0f}%):")
        for detail in rec['criteria_details']:
            output.append(f"  {detail}")
        
        output.append("")
    
    # Summary footer
    if len(recommendations) > max_programs:
        output.append(f"\nðŸ’¡ Note: I found {len(recommendations)} total matches. Showing top {max_programs}.")
        output.append("Would you like to see more options?\n")
    
    output.append("\n" + "="*70)
    output.append("NEXT STEPS:")
    output.append("="*70)
    output.append("1. Review these programs and choose which interests you most")
    output.append("2. Follow the 'How to Get Started' instructions for your chosen program(s)")
    output.append("3. Contact AbilityPath if you have questions: intake@abilitypath.org")
    output.append("\nWould you like more information about any of these programs?")
    
    return "\n".join(output)
